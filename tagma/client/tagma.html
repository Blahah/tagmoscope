<head>
  <title>tagma</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

</head>

<body>

  <script>
    $(document).ready(function(){
      $('.collapsible').collapsible();
      $('.tooltipped').tooltip({delay: 0});
    });
  </script>

  <div class="container">
    <!-- Page Content goes here -->

    {{> header}}

    {{> search}}

    {{> taskList}}

    {{> actionButton}}

  </div>

  {{> addTaskModal}}
  {{> addTaskFrequencyModal}}

</body>

<template name="header">
  <div class="text-center">
    <center><strong><h1 class="text-center">
      <span class="light-blue-text">T</span>
      <span class="teal-text">A</span>
      <span class="lime-text">G</span>
      <span class="amber-text">M</span>
      <span class="deep-orange-text">A</span>
    </h1></strong></center>
  </div>
</template>

<template name="search">
  <div class="row">
    <nav class="white">
      <div class="nav-wrapper">
        <form>
          <div class="input-field">
            <input id="search" type="search" required>
            <label for="search"><i class="material-icons blue-grey-text">search</i></label>
            {{> sortAndFilter}}
          </div>
        </form>
      </div>
    </nav>
  </div>
</template>

<template name="taskList">
  {{#if isLoading}}
    {{>spinner}}
  {{else}}
  <div class="col s12 m8 offset-m2 l6 offset-l3">
    <ul class="collapsible popout" data-collapsible="accordion">
      {{#each tasks}}
        {{> taskPopout}}
      {{/each}}
    </ul>
  </div>
  {{/if}}
</template>

<template name="taskPopout">
  <li class="task">
    <div class="collapsible-header {{#if completed}}grey lighten-5{{/if}}">
      <span class="task-title grey-text text-darken-3" style="width: 200px;"><strong>{{title}}</strong></span>
      <span class="project weeny-badge light-blue lighten-2 tooltipped" data-tooltip="project">
        <i class="material-icons" style="font-size: 1rem; display: inline; float: none; margin-right: 3px; vertical-align: bottom;">work</i><strong>{{project}}</strong>
      </span>
      {{#if guilt}}<span class="weeny-badge orange lighten-2 tooltipped" data-tooltip="guilt">
        <i class="material-icons" style="font-size: 1rem; display: inline; float: none; margin-right: 3px; vertical-align: bottom;">warning</i><strong>{{guilt}}</strong>
      </span>{{/if}}
      {{#if due_at}}<span class="blue-grey-text text-lighten-4" style="margin-left: 10px;">{{due_at}}</span>{{/if}}
      <span class="task-btns right">
        <!-- edit -->
        <a href="#!" class="teal-text task-edit text-lighten-3">
          <i class="material-icons tooltipped" data-tooltip="toggle edit mode">edit</i>
        </a>
        <!-- complete -->
        <a href="#!" class="green-text task-complete text-lighten-3">
          {{#if completed}}
          <i class="material-icons tooltipped" data-tooltip="un-complete">check_box_outline_blank</i>
          {{else}}
          <i class="material-icons tooltipped" data-tooltip="complete">check_box</i>
          {{/if}}
        </a>
        <!-- guilt -->
        <a href="#!" class="orange-text task-guilt text-lighten-3">
          <i class="material-icons tooltipped" data-tooltip="add guilt">add_alert</i>
        </a>
        <!-- delete -->
        <a href="#!" class="red-text task-delete text-lighten-3">
          <i class="material-icons tooltipped" data-tooltip="delete">delete</i>
        </a>

      </span>
    </div>
    <div class="collapsible-body flow-text" style="min-height: 150px;">
      <div id="{{_id}}_content" class="task-content">
        {{#markdown}}{{content}}{{/markdown}}
      </div>
    </div>
  </li>
</template>

<template name="actionButton">
  <div class="fixed-action-btn" style="bottom: 45px; right: 24px;">
    <a class="btn-floating btn-large light-blue">
      <i class="large material-icons">menu</i>
    </a>
    <ul>
      <!-- <li><a class="btn-floating lime"><i class="material-icons">publish</i></a></li>
      <li><a class="btn-floating amber"><i class="material-icons">attach_file</i></a></li> -->
      <li><a id="add-task-btn" class="btn-floating teal modal-trigger"  href="#add-task-modal"><i class="material-icons tooltipped" data-tooltip="new task" data-position="left">add</i></a></li>
    </ul>
  </div>
</template>

<template name="addTaskModal">
  <div class="modal bottom-sheet" id="add-task-modal">
    <form id="add-form">
      <div class="modal-content" style="padding-bottom: 0;">
        <div class="input-field">
          <input placeholder="Task title" name="title" type="text" class="validate card-title grey-text">
        </div>
        <div class="input-field">
          <input placeholder="Project" name="project" type="text" class="validate">
        </div>
        {{> addTaskTimeSettings}}
        <div class="input-field">
          <textarea name="content" class="materialize-textarea" style="margin-bottom: 0;" placeholder="Task description"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-flat waves-effect waves-green left" type="submit" name="add">Add</button>
        <button class="btn-flat waves-effect waves-red right" type="button" name="cancel">Cancel</button>
      </div>
    </form>
  </div>
</template>

<template name="addTaskTimeSettings">
  <div class="row" style="padding: 0; margin: 0;">
    <div class="input-field col s6" style="padding-left: 0;">
      <label for="duedate">Due date</label>
      <input type="date" class="datepicker" name="duedate">
    </div>
    <div class="input-field col s6" style="padding-right: 0;">
      <label for="frequency">Frequency</label>
      <input type="text" id="add-task-frequency" name="frequency">
    </div>
  </div>
</template>

<template name="addTaskFrequencyModal">
  <div id="add-task-frequency-modal" class="modal bottom-sheet">
    <form id="add-task-frequency-form">
      <div class="modal-content" style="padding-bottom: 0;">
        <h4>Task frequency</h4>
        <div class="row" style="margin: 0;">
          <div class="input-field col s4">
            <label>Number</label>
            <input type="number" name="number" placeholder="1">
          </div>
          <div class="input-field col s4">
            <span class="text-grey flow-text center-align">times a</span>
          </div>
          <div class="input-field col s4">
            <div class="select-wrapper">
              <select name="timeperiod">
                <option value="week" selected>week</option>
                <option value="month">month</option>
                <option value="year">year</option>
              </select>
            </div>
            <label>Timeperiod</label>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <a href="#!" id="add-task-frequency-modal-clear" class="modal-close waves-effect waves-red btn-flat left">Clear</a>
        <a href="#!" id="add-task-frequency-modal-choose" class="modal-action modal-close submit waves-effect waves-green btn-flat right">Choose</a>
      </div>
    </form>
  </div>
</template>

<template name="spinner">
  <div class="row center">
    <div class="preloader-wrapper small active">
      <div class="spinner-layer spinner-blue">
        <div class="circle-clipper left">
          <div class="circle"></div>
        </div><div class="gap-patch">
          <div class="circle"></div>
        </div><div class="circle-clipper right">
          <div class="circle"></div>
        </div>
      </div>

      <div class="spinner-layer spinner-red">
        <div class="circle-clipper left">
          <div class="circle"></div>
        </div><div class="gap-patch">
          <div class="circle"></div>
        </div><div class="circle-clipper right">
          <div class="circle"></div>
        </div>
      </div>

      <div class="spinner-layer spinner-yellow">
        <div class="circle-clipper left">
          <div class="circle"></div>
        </div><div class="gap-patch">
          <div class="circle"></div>
        </div><div class="circle-clipper right">
          <div class="circle"></div>
        </div>
      </div>

      <div class="spinner-layer spinner-green">
        <div class="circle-clipper left">
          <div class="circle"></div>
        </div><div class="gap-patch">
          <div class="circle"></div>
        </div><div class="circle-clipper right">
          <div class="circle"></div>
        </div>
      </div>
    </div>
  </div>
</template>

<template name="sortAndFilter">
  <a href="#" data-activates="sort-dropdown" data-hover="true" data-beloworigin="true" data-constrainwidth="false" style="display: box; float: right; position: absolute; right: 15px; top: 0;" class="dropdown-button"><i class="material-icons blue-grey-text">sort</i></a>
  <div id="sort-dropdown" class="dropdown-content">
    <form action="#">
        <p class="grey-text">Sort</p>
        <p id="sort-radiogroup">
        <input class="with-gap" name="sort" value="sort-created-desc" type="radio" id="sort-created-desc" checked="checked" />
        <label for="sort-created-desc">Created desc</label><br>
        <input class="with-gap" name="sort" value="sort-created-asc" type="radio" id="sort-created-asc" />
        <label for="sort-created-asc">Created asc</label><br>
        <input class="with-gap" name="sort" value="sort-guilt-desc" type="radio" id="sort-guilt-desc" />
        <label for="sort-guilt-desc">Guilt desc</label></p>
        <hr>
        <p class="grey-text">Filter</p>
        <input type="checkbox" class="filled-in" id="filter-show-checked" />
        <label for="filter-show-checked">Show completed</label>
    </form>
  </div>
</template>
